(function(a,b,c){var d=b.event,e;d.special.smartresize={setup:function(){b(this).bind("resize",d.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",d.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize";if(e){clearTimeout(e)}e=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:300)}};b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])};b.Sinusoid=function(a,c){this.$wrapper=b(c);this.$scroller=this.$wrapper.find("div.wd-scroll-wrapper");this.$el=this.$wrapper.find("div.wd-container");this.$slider=this.$wrapper.find("div.wd-slider");this.$items=this.$el.children("div.wd-element");this.itemXSize=this.$items.width();this.itemYSize=this.$items.height();this.ratio=this.itemXSize/this.itemYSize;this.itemsCount=this.$items.length;this.mode="small";this.current=0;this._init(a)};b.Sinusoid.defaults={initMode:"small",circular:true,speed:1e3,easing:"easeInOutExpo",minImgW:50,maxImgW:90,minImgAngle:-15,maxImgAngle:+15,leftFactor:40,startFactor:1,marginMedium:0,sinusoidFunction:{A:100,T:700,P:0}};b.Sinusoid.prototype={_init:function(a){this.options=b.extend(true,{},b.Sinusoid.defaults,a);this.sinusoidFunction={A:this.options.sinusoidFunction.A,T:this.options.sinusoidFunction.T,P:this.options.sinusoidFunction.P};this._set();this._validate();var c=this.options.initMode;if(this.options.initMode==="medium"){this.$items.addClass("wd-element-medium");this.mode="medium"}this._render();this._initSlider();this._initEvents()},_initSlider:function(){var a=this,b=a.$items.eq(a.itemsCount-1),c=b.position().left+b.width()-a.$wrapper.width();if(c<0)c=0;this.$slider.slider({max:c,min:0,value:0,slide:function(b,c){a.$el.css("left",-c.value+"px")}});if(c===0)this.$slider.hide()},_reinitSlider:function(){var a=this,b=a.$items.eq(a.itemsCount-1),c,d;this.mode==="small"?(c=b.data("originalLeft"),d=b.data("originalWidth")):(c=this.itemsCount*this.itemXSize-this.itemXSize/2,d=this.itemXSize);var e=c+d-a.$wrapper.width();if(e<0){e=0;this.$slider.hide()}else{this.$slider.show()}this.$slider.slider("option","max",e)},_setSlider:function(){var a;this.mode==="small"?a=this.$wrapper.width()/2-this.$items.eq(this.current).data("originalLeft")-this.$items.eq(this.current).data("originalWidth")/2:a=this.$wrapper.width()/2-(this.current+1)*this.itemXSize;var b;if(a>0)b=0;else b=-Math.min(Math.abs(a),this.$slider.slider("option","max"));this.$slider.slider("value",Math.abs(b));this.$el.stop().animate({left:b},this.options.speed,this.options.easing)},_set:function(){var a=this.$wrapper.height(),b=50;this.options.sinusoidFunction.A>a/2-b?this.sinusoidFunction.A=a/2-b:this.sinusoidFunction.A=this.options.sinusoidFunction.A;this.sinusoidFunction.D=a/2},_validate:function(){if(this.itemYSize>this.$wrapper.height()){this.itemYSize=this.$wrapper.height();this.itemXSize=this.itemYSize*this.ratio}if(this.options.minImgW<1||this.options.minImgW>this.options.maxImgW)this.options.minImgW=this.options.maxImgW;if(this.options.maxImgW>this.itemXSize||this.options.maxImgW<1)this.options.maxImgW=this.itemXSize;if(this.options.leftFactor<0)this.options.leftFactor=this.options.minImgW},_render:function(a,d){var e=this;b.fn.applyStyle=a!==c?b.fn.animate:b.fn.css;this.$items.each(function(c){var f=b(this);var g=e.mode==="medium"?e.itemXSize-e.options.marginMedium:f.data("originalWidth")?f.data("originalWidth"):Math.floor(Math.random()*(e.options.maxImgW-e.options.minImgW+1)+e.options.minImgW),h=g/e.ratio,i=e.mode==="medium"?e.itemXSize:e.options.leftFactor,j=e.options.startFactor,k=f.data("originalAngle")||Math.floor(Math.random()*(e.options.maxImgAngle-e.options.minImgAngle+1)+e.options.minImgAngle),l={width:g,height:h,left:(c+j)*i-g/2,top:e.mode==="medium"?e._getTop((c+j)*i)-h/2:e._getTop((c+j)*i)-h/2,"-webkit-transform":"rotate("+k+"deg)","-moz-transform":"rotate("+k+"deg)","-o-transform":"rotate("+k+"deg)",transform:"rotate("+k+"deg)"};if(e.mode==="small"){f.removeClass("wd-element-medium").addClass("wd-element-small")}f.stop().applyStyle(l,b.extend(true,[],{duration:e.options.speed,easing:e.options.easing,complete:function(){if(e.mode==="medium")b(this).removeClass("wd-element-small").addClass("wd-element-medium");if(c===e.itemsCount-1&&d){d.call()}}}));if(!f.data("originalWidth")){f.data({originalWidth:g,originalAngle:k,originalLeft:(c+j)*i-g/2})}if(!a&&d)d.call()})},_getTop:function(a,b,d){var e=this.sinusoidFunction.D,f=this.sinusoidFunction.P,b,d;b!==c?b=b:b=this.sinusoidFunction.A;d!==c?d=d:d=this.sinusoidFunction.T;return b*Math.sin(2*Math.PI/d*a+f)+e},_initEvents:function(){var c=this;this.$scroller.bind("mousewheel.sinusoid",function(a,b){a.preventDefault();if(b>0){c._navigate("prev")}else{c._navigate("next")}return false});this.$items.bind("click.sinusoid",function(a){var d=b(this);c.current=d.index();if(c.mode==="small"){c.mode="medium";c._reinitSlider();c._setSlider();c._render(true,function(){c._addControls()})}else if(c.mode==="medium"){c._setSlider();c._showItem(d)}});b(a).bind("smartresize.sinusoid",function(a){c.mode=c.options.initMode;if(c.$overlay)c.$overlay.hide();if(c.$zoomOut)c.$zoomOut.hide();c._set();c._reinitSlider();c._setSlider();c._render(true)})},_showItem:function(a){var c=a.find("img").attr("src"),d=a.find("div.wd-info-title").html(),e=a.find("div.wd-info-desc").html(),f=this;if(!this.$overlay){b("#fullscreenTmpl").tmpl({source:c,title:d,description:e}).prependTo(this.$wrapper).show();this.$overlay=b("#wd-overlay");this.$overlayImg=this.$overlay.find("img");this.$overlayTitle=this.$overlay.find("div.wd-info-title");this.$overlayDescription=this.$overlay.find("div.wd-info-desc");this.$overlayNavNext=this.$overlay.find("span.wd-nav-next");this.$overlayNavPrev=this.$overlay.find("span.wd-nav-prev");this.$overlayImg.attr("src",c);if(!this.options.circular){if(this.current==this.itemsCount-1){this.$overlayNavNext.hide()}else{this.$overlayNavNext.show()}if(this.current==0){this.$overlayNavPrev.hide()}else{this.$overlayNavPrev.show()}}this.$overlay.find("span.wd-close").bind("click.sinusoid",function(a){f.$overlay.hide()});this.$overlayNavNext.bind("click.sinusoid",function(a){f._navigate("next")});this.$overlayNavPrev.bind("click.sinusoid",function(a){f._navigate("prev")});this.$overlay.bind("mousewheel.sinusoid",function(a,b){if(b>0){f._navigate("prev")}else{f._navigate("next")}return false})}else{this.$overlayImg.attr("src",c);this.$overlayTitle.html(d);this.$overlayDescription.html(e);this.$overlay.show();if(!this.options.circular){if(this.current==this.itemsCount-1){this.$overlayNavNext.hide()}else{this.$overlayNavNext.show()}if(this.current==0){this.$overlayNavPrev.hide()}else{this.$overlayNavPrev.show()}}}},_navigate:function(a){if(a==="next"){++this.current;if(this.current>this.itemsCount-1){if(this.options.circular){this.current=0}else{this.current=this.itemsCount-1}}}else if(a==="prev"){--this.current;if(this.current<0){if(this.options.circular){this.current=this.itemsCount-1}else{this.current=0}}}var b=this;this._setSlider();if(this.$overlay.is(":visible")){this._showItem(this.$items.eq(this.current))}},_addControls:function(){var a=this;if(!this.$zoomOut){this.$zoomOut=b('<div class="wd-zoom-out">Zoom out</div>').prependTo(this.$wrapper).bind("click.sinusoid",function(c){a.mode="small";a._reinitSlider();a._setSlider();a._render(true);b(this).hide()})}else this.$zoomOut.show()}};var f=function(a){if(this.console){console.error(a)}};b.fn.sinusoid=function(a){if(typeof a==="string"){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=b.data(this,"sinusoid");if(!d){f("cannot call methods on sinusoid prior to initialization; "+"attempted to call method '"+a+"'");return}if(!b.isFunction(d[a])||a.charAt(0)==="_"){f("no such method '"+a+"' for sinusoid instance");return}d[a].apply(d,c)})}else{this.each(function(){var c=b.data(this,"sinusoid");if(!c){b.data(this,"sinusoid",new b.Sinusoid(a,this))}})}return this}})(window,jQuery)